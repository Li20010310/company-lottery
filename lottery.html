<!DOCTYPE html>
<html>
<head>
    <title>æˆæœå±•å¹¸è¿æŠ½å¥–</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; text-align: center; margin: 0; padding: 0; background: linear-gradient(45deg, #1a2a6c, #b21f1f, #fdbb2d); background-size: 400% 400%; animation: gradient 15s ease infinite; color: white; height: 100vh; display: flex; justify-content: center; align-items: center; }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .lottery-container { background: rgba(0, 0, 0, 0.7); padding: 40px 60px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); width: 80%; max-width: 900px; }
        h1 { font-size: 3.5rem; margin-bottom: 10px; text-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        h1 span { color: #FFD700; }
        
        .winner-display { min-height: 280px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; display: flex; justify-content: center; align-items: center; margin: 30px 0; font-size: 2rem; font-weight: bold; padding: 20px; border: 3px dashed rgba(255, 215, 0, 0.5); }
        
        .winner-name { font-size: 4rem; color: #FFD700; text-shadow: 0 0 30px rgba(255, 215, 0, 0.8); animation: glow 1s infinite alternate; }
        @keyframes glow { from { text-shadow: 0 0 20px rgba(255, 215, 0, 0.7); } to { text-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.8); } }
        
        .controls { margin: 30px 0; }
        #drawBtn { background: linear-gradient(45deg, #FF416C, #FF4B2B); color: white; border: none; padding: 20px 50px; font-size: 1.8rem; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 10px 20px rgba(255, 65, 108, 0.4); transition: all 0.3s; margin: 15px; }
        #drawBtn:hover { transform: translateY(-5px); box-shadow: 0 15px 25px rgba(255, 65, 108, 0.6); }
        #drawBtn:disabled { background: #666; cursor: not-allowed; }
        
        .winners-list { max-height: 200px; overflow-y: auto; text-align: left; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-top: 20px; }
        .winners-list h3 { margin-top: 0; color: #FFD700; }
        .winners-list div { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        .stats { display: flex; justify-content: space-around; margin-top: 25px; font-size: 1.2rem; }
        .stat-box { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; min-width: 150px; }
    </style>
</head>
<body>
    <div class="lottery-container">
        <h1>ğŸ <span>å¹¸è¿å¤§æŠ½å¥–</span> ğŸ</h1>
        <p style="font-size: 1.2rem;">ä»…é™å·²ç­¾åˆ°äººå‘˜å‚ä¸ï¼Œæ¯äººä»…å¯ä¸­å¥–ä¸€æ¬¡</p>
        
        <div class="winner-display">
            <div id="winnerArea">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æŠ½å¥–</div>
        </div>
        
        <div class="controls">
            <button id="drawBtn" onclick="drawWinner()">âœ¨ æŠ½å–å¹¸è¿å„¿ âœ¨</button>
            <button onclick="resetWinners()" style="background: #444; color: white; padding: 15px 30px; border-radius: 50px;">ğŸ”„ é‡ç½®ä¸­å¥–è®°å½•</button>
        </div>
        
        <div class="stats">
            <div class="stat-box">å·²ç­¾åˆ°ï¼š<span id="signedCount">0</span>äºº</div>
            <div class="stat-box">å¾…æŠ½å¥–ï¼š<span id="poolCount">0</span>äºº</div>
            <div class="stat-box">å·²ä¸­å¥–ï¼š<span id="wonCount">0</span>äºº</div>
        </div>
        
        <div class="winners-list">
            <h3>ğŸ‰ ä¸­å¥–åå• ğŸ‰</h3>
            <div id="winnersList"></div>
        </div>
    </div>
    
    <script>
        // åˆå§‹åŒ–æ•°æ®
        let lotteryPool = [];
        let winners = [];
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        function loadData() {
            // ä» localStorage è¯»å–ï¼ˆå®é™…åº”æ›¿æ¢ä¸º Firebase ç›‘å¬ï¼‰
            lotteryPool = JSON.parse(localStorage.getItem('lotteryPool') || '[]');
            winners = JSON.parse(localStorage.getItem('winners') || '[]');
            
            updateDisplay();
            updateStats();
        }
        
        // æŠ½å–è·å¥–è€…
        function drawWinner() {
            const btn = document.getElementById('drawBtn');
            btn.disabled = true;
            
            // ç­›é€‰æœªä¸­å¥–è€…
            const availableUsers = lotteryPool.filter(user => !user.isWon);
            if (availableUsers.length === 0) {
                document.getElementById('winnerArea').innerHTML = 'âš ï¸ æ‰€æœ‰ç­¾åˆ°è€…å‡å·²è·å¥–ï¼';
                return;
            }
            
            // æŠ½å¥–åŠ¨ç”»æ•ˆæœ
            let counter = 0;
            const interval = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * availableUsers.length);
                document.getElementById('winnerArea').innerHTML = 
                    `<div class="winner-name">${availableUsers[randomIndex].name}</div>`;
                counter++;
                if (counter > 30) { // åŠ¨ç”»æŒç»­çº¦1.5ç§’
                    clearInterval(interval);
                    
                    // ç¡®å®šæœ€ç»ˆè·å¥–è€…
                    const winnerIndex = Math.floor(Math.random() * availableUsers.length);
                    const winner = availableUsers[winnerIndex];
                    
                    // æ›´æ–°çŠ¶æ€
                    winner.isWon = true;
                    winner.wonTime = new Date().toLocaleTimeString();
                    winners.push(winner);
                    
                    // ä¿å­˜æ•°æ®
                    localStorage.setItem('lotteryPool', JSON.stringify(lotteryPool));
                    localStorage.setItem('winners', JSON.stringify(winners));
                    
                    // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
                    document.getElementById('winnerArea').innerHTML = `
                        <div>
                            <div class="winner-name">${winner.name}</div>
                            <div style="font-size: 1.5rem; margin-top: 20px;">ğŸŠ æ­å–œä¸­å¥–ï¼ ğŸŠ</div>
                        </div>
                    `;
                    
                    updateDisplay();
                    updateStats();
                    btn.disabled = false;
                    
                    // æ’­æ”¾éŸ³æ•ˆï¼ˆå¯é€‰ï¼‰
                    const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3');
                    audio.volume = 0.3;
                    audio.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢"));
                }
            }, 50);
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const listEl = document.getElementById('winnersList');
            listEl.innerHTML = winners.map((w, i) => 
                `<div>${i+1}. ${w.name} <span style="float:right; color:#aaa;">${w.wonTime || ''}</span></div>`
            ).join('');
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const signedCount = lotteryPool.length;
            const wonCount = winners.length;
            const poolCount = signedCount - wonCount;
            
            document.getElementById('signedCount').textContent = signedCount;
            document.getElementById('poolCount').textContent = poolCount;
            document.getElementById('wonCount').textContent = wonCount;
        }
        
        // é‡ç½®ä¸­å¥–è®°å½•ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
        function resetWinners() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä¸­å¥–è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                lotteryPool.forEach(user => user.isWon = false);
                winners = [];
                localStorage.setItem('lotteryPool', JSON.stringify(lotteryPool));
                localStorage.setItem('winners', JSON.stringify(winners));
                loadData();
                document.getElementById('winnerArea').innerHTML = 'ä¸­å¥–è®°å½•å·²é‡ç½®ï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æŠ½å¥–';
            }
        }
        
        // å®šæ—¶åŒæ­¥æ•°æ®ï¼ˆæ¨¡æ‹Ÿäº‘ç«¯å®æ—¶åŒæ­¥ï¼‰
        setInterval(loadData, 2000);
        
        // é¡µé¢åŠ è½½
        window.onload = loadData;
    </script>
</body>
</html>