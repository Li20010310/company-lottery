<!DOCTYPE html>
<html>
<head>
    <title>æˆæœå±•ç­¾åˆ° - å‚ä¸æŠ½å¥–</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; text-align: center; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .container { max-width: 500px; margin: 0 auto; background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; backdrop-filter: blur(10px); }
        .qrcode { margin: 30px 0; background: white; padding: 15px; display: inline-block; border-radius: 10px; }
        input, button { padding: 12px; margin: 10px; width: 80%; border-radius: 8px; border: none; font-size: 16px; }
        button { background: #FFD700; color: #333; font-weight: bold; cursor: pointer; }
        #message { margin-top: 20px; font-weight: bold; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ æˆæœå±•æŠ½å¥–ç­¾åˆ° ğŸ‰</h1>
        <p>è¯·æ‰«ç ç­¾åˆ°ï¼Œå³å¯å‚ä¸æŠ½å¥–æ´»åŠ¨</p>
        <div class="qrcode" id="qrcode"></div>
        <p>æˆ–ç›´æ¥è¾“å…¥å§“åï¼š</p>
        <input type="text" id="name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
        <button onclick="signIn()">ç¡®è®¤ç­¾åˆ°</button>
        <div id="message"></div>
        <p style="font-size: 14px; margin-top: 30px;">ç­¾åˆ°æˆåŠŸå³è¿›å…¥æŠ½å¥–æ± ï¼Œæ¯äººä»…æœ‰ä¸€æ¬¡ä¸­å¥–æœºä¼š</p>
    </div>
    
    <script>
        // ç”Ÿæˆå½“å‰é¡µé¢äºŒç»´ç ï¼ˆæ–¹ä¾¿æ‰‹æœºæ‰«ç ï¼‰
        const pageUrl = window.location.href;
        QRCode.toCanvas(document.getElementById('qrcode'), pageUrl, { width: 200 });
        
        // ä½¿ç”¨ Firebase ä½œä¸ºäº‘ç«¯æ•°æ®åº“ï¼ˆå…è´¹ã€å®æ—¶ï¼‰
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        // åˆå§‹åŒ– Firebaseï¼ˆæ‚¨éœ€è¦å…ˆåˆ›å»º Firebase é¡¹ç›®ï¼‰
        // firebase.initializeApp(firebaseConfig);
        // const db = firebase.firestore();
        
        // ä¸ºç®€åŒ–æ¼”ç¤ºï¼Œè¿™é‡Œä½¿ç”¨ localStorage + å®šæ—¶åŒæ­¥æ¨¡æ‹Ÿäº‘ç«¯
        async function signIn() {
            const name = document.getElementById('name').value.trim();
            if (!name) { alert('è¯·è¾“å…¥å§“å'); return; }
            
            // 1. æœ¬åœ°å­˜å‚¨ç­¾åˆ°è®°å½•
            let signedUsers = JSON.parse(localStorage.getItem('signedUsers') || '[]');
            if (signedUsers.includes(name)) {
                document.getElementById('message').innerHTML = 'æ‚¨å·²ç­¾åˆ°ï¼Œæ— éœ€é‡å¤æ“ä½œï¼';
                return;
            }
            signedUsers.push(name);
            localStorage.setItem('signedUsers', JSON.stringify(signedUsers));
            
            // 2. åŒæ­¥åˆ°æŠ½å¥–æ± ï¼ˆå®é™…ä½¿ç”¨æ—¶åº”æ›¿æ¢ä¸º Firebase å†™å…¥ï¼‰
            let lotteryPool = JSON.parse(localStorage.getItem('lotteryPool') || '[]');
            if (!lotteryPool.find(u => u.name === name)) {
                lotteryPool.push({ name, id: Date.now(), isWon: false });
                localStorage.setItem('lotteryPool', JSON.stringify(lotteryPool));
            }
            
            document.getElementById('message').innerHTML = `âœ… ${name}ï¼Œç­¾åˆ°æˆåŠŸï¼ç¥æ‚¨å¥½è¿ï¼`;
            document.getElementById('name').value = '';
            
            // 3. æ¨¡æ‹ŸåŒæ­¥åˆ°äº‘ç«¯ï¼ˆå®é™…åº”ä½¿ç”¨ Firebase çš„ setDoc æˆ– updateDocï¼‰
            console.log('æ•°æ®å·²åŒæ­¥åˆ°æŠ½å¥–æ± :', lotteryPool);
        }
    </script>
</body>
</html>