<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆæœå±•ç»Ÿä¸€ç­¾åˆ°å…¥å£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            padding: 40px 30px;
            width: 100%;
            max-width: 480px;
            text-align: center;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        h1 {
            color: #1a2980;
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .company-name {
            color: #26d0ce;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .qrcode-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #e3f2fd;
            margin: 25px auto;
            display: inline-block;
            position: relative;
        }
        
        .qrcode-label {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a2980;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        #qrcode {
            width: 220px;
            height: 220px;
            margin: 0 auto;
        }
        
        .signin-form {
            margin: 30px 0;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #1a2980;
        }
        
        .form-title {
            color: #1a2980;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: left;
            font-weight: bold;
        }
        
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #1a2980;
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            flex: 1;
            padding: 16px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        #signinBtn {
            background: linear-gradient(45deg, #1a2980, #26d0ce);
            color: white;
        }
        
        #signinBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(26, 41, 128, 0.3);
        }
        
        #signinBtn:active {
            transform: translateY(0);
        }
        
        #checkStatusBtn {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #ddd;
        }
        
        #checkStatusBtn:hover {
            background: #e0e0e0;
        }
        
        #message {
            margin-top: 20px;
            padding: 18px;
            border-radius: 10px;
            font-weight: 500;
            display: none;
            text-align: left;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #c8e6c9;
            display: block !important;
        }
        
        .warning {
            background-color: #fff3e0;
            color: #ef6c00;
            border: 2px solid #ffe0b2;
            display: block !important;
        }
        
        .error {
            background-color: #ffebee;
            color: #c62828;
            border: 2px solid #ffcdd2;
            display: block !important;
        }
        
        .info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 2px solid #bbdefb;
            display: block !important;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #1a2980;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .instructions {
            margin-top: 25px;
            padding: 20px;
            background: #fff8e1;
            border-radius: 10px;
            text-align: left;
            font-size: 0.9rem;
            color: #5d4037;
            border-left: 4px solid #ffb300;
        }
        
        .instructions h3 {
            color: #ff8f00;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .footer {
            margin-top: 25px;
            color: #777;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        .fallback-url {
            margin-top: 15px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 8px;
            font-size: 0.9rem;
            word-break: break-all;
            font-family: monospace;
            color: #333;
            border: 1px dashed #bbb;
        }
        
        .signature {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            color: #999;
            font-size: 0.8rem;
        }
    </style>
    
    <!-- ä½¿ç”¨å›½å†…ç¨³å®šçš„QRCodeåº“ -->
    <script src="https://cdn.bootcdn.net/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å…¬å¸æˆæœå±•ç»Ÿä¸€ç­¾åˆ°ç³»ç»Ÿ</h1>
            <p class="subtitle">2025å¹´åº¦ç§‘æŠ€åˆ›æ–°æˆæœå±•ç¤ºä¼š</p>
            <div class="company-name">âš¡ å¹³é«˜é›†å›¢å‚¨èƒ½ç§‘æŠ€æœ‰é™å…¬å¸</div>
        </div>
        
        <div class="qrcode-container">
            <div class="qrcode-label">ç»Ÿä¸€ç­¾åˆ°äºŒç»´ç </div>
            <div id="qrcode"></div>
        </div>
        
        <p style="color: #666; margin: 15px 0;">
            æ‰€æœ‰å‘˜å·¥è¯·æ‰«æä¸Šæ–¹äºŒç»´ç ï¼Œè¾“å…¥å§“åå®Œæˆç­¾åˆ°
        </p>
        
        <div class="signin-form">
            <div class="form-title">ğŸ“ ä¸ªäººä¿¡æ¯ç™»è®°</div>
            
            <div class="input-group">
                <label for="name">æ‚¨çš„å§“åï¼ˆå¿…å¡«ï¼‰</label>
                <input type="text" id="name" placeholder="è¯·è¾“å…¥çœŸå®å§“åï¼Œå¦‚ï¼šå¼ ä¸‰" autocomplete="off" maxlength="20">
            </div>
            
            <div class="input-group">
                <label for="department">æ‰€åœ¨éƒ¨é—¨ï¼ˆé€‰å¡«ï¼‰</label>
                <input type="text" id="department" placeholder="å¦‚ï¼šç ”å‘éƒ¨ã€å¸‚åœºéƒ¨ç­‰" autocomplete="off" maxlength="30">
            </div>
            
            <div class="button-group">
                <button id="signinBtn" onclick="signIn()">
                    âœ… æäº¤ç­¾åˆ°
                </button>
                <button id="checkStatusBtn" onclick="checkSigninStatus()">
                    ğŸ” æŸ¥çœ‹çŠ¶æ€
                </button>
            </div>
        </div>
        
        <div id="message"></div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">å·²ç­¾åˆ°äººæ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="todayCount">0</div>
                <div class="stat-label">ä»Šæ—¥ç­¾åˆ°</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="lotteryCount">0</div>
                <div class="stat-label">æŠ½å¥–èµ„æ ¼</div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“Œ ç­¾åˆ°é¡»çŸ¥</h3>
            <ul>
                <li>æ¯äººåªéœ€ç­¾åˆ°ä¸€æ¬¡ï¼Œè¯·å‹¿é‡å¤æäº¤</li>
                <li>ç­¾åˆ°æˆåŠŸåè‡ªåŠ¨è·å¾—æŠ½å¥–èµ„æ ¼</li>
                <li>æŠ½å¥–å°†åœ¨ä¸»ä¼šåœºå¤§å±å¹•å®æ—¶è¿›è¡Œ</li>
                <li>ä¸­å¥–ç»“æœä»¥æŠ½å¥–ç³»ç»Ÿæ˜¾ç¤ºä¸ºå‡†</li>
                <li>å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ä¼šåŠ¡ç»„å·¥ä½œäººå‘˜</li>
            </ul>
        </div>
        
        <div class="footer">
            <p><strong>å¤‡ç”¨è®¿é—®æ–¹å¼ï¼š</strong> å¦‚æœäºŒç»´ç æ— æ³•æ‰«æï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ä»¥ä¸‹ç½‘å€ï¼š</p>
            <div class="fallback-url" id="pageUrl">æ­£åœ¨è·å–URL...</div>
            <div class="signature">ç³»ç»Ÿç‰ˆæœ¬ v1.0 | æŠ€æœ¯æ”¯æŒï¼šæ•°å­—åŒ–éƒ¨ | æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œå®‰å…¨å¯é </div>
        </div>
    </div>
    
    <script>
        // ==================== ç³»ç»Ÿé…ç½® ====================
        const CONFIG = {
            STORAGE_KEY: 'company_event_2025',  // æœ¬åœ°å­˜å‚¨é”®å
            EVENT_NAME: '2025å¹´åº¦æˆæœå±•ç¤ºä¼š',
            MAX_NAME_LENGTH: 20,
            MAX_DEPT_LENGTH: 30
        };
        
        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        window.onload = function() {
            console.log('ç­¾åˆ°ç³»ç»Ÿåˆå§‹åŒ–...');
            
            // 1. æ˜¾ç¤ºå½“å‰é¡µé¢URLï¼ˆå¤‡ç”¨è®¿é—®ï¼‰
            document.getElementById('pageUrl').textContent = window.location.href;
            
            // 2. ç”Ÿæˆå›ºå®šäºŒç»´ç ï¼ˆå…³é”®ä¿®æ”¹ï¼ï¼‰
            // æ‰€æœ‰å‘˜å·¥éƒ½æ‰«æè¿™ä¸ªå›ºå®šé¡µé¢çš„äºŒç»´ç 
            generateFixedQRCode();
            
            // 3. æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStatistics();
            
            // 4. ç»‘å®šå›è½¦é”®æäº¤
            document.getElementById('name').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') signIn();
            });
            
            // 5. æ£€æŸ¥QRCodeåº“æ˜¯å¦åŠ è½½
            setTimeout(checkQRCodeLibrary, 1000);
            
            // 6. è‡ªåŠ¨ä¿å­˜å½“å‰URLåˆ°æŠ½å¥–é¡µé¢èƒ½è®¿é—®çš„åœ°æ–¹
            saveCheckinUrlForLottery();
        };
        
        // ==================== ç”Ÿæˆå›ºå®šäºŒç»´ç  ====================
        function generateFixedQRCode() {
            const qrcodeElement = document.getElementById('qrcode');
            
            if (typeof QRCode === 'undefined') {
                console.error('QRCodeåº“æœªåŠ è½½ï¼Œæ˜¾ç¤ºå¤‡ç”¨ä¿¡æ¯');
                qrcodeElement.innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <p style="color: red; font-weight: bold;">äºŒç»´ç ç”Ÿæˆå¤±è´¥</p>
                        <p>è¯·æ‰‹åŠ¨è®¿é—®ï¼š</p>
                        <p><strong>${window.location.href}</strong></p>
                    </div>
                `;
                return;
            }
            
            try {
                // æ¸…ç©ºå®¹å™¨
                qrcodeElement.innerHTML = '';
                
                // ç”Ÿæˆå½“å‰é¡µé¢çš„äºŒç»´ç 
                // è¿™æ˜¯å…³é”®ï¼šæ‰€æœ‰äººéƒ½æ‰«æè¿™ä¸ªå›ºå®šçš„checkin.htmlé¡µé¢
                const qrcode = new QRCode(qrcodeElement, {
                    text: window.location.href,  // å›ºå®šé¡µé¢URL
                    width: 200,
                    height: 200,
                    colorDark: "#1a2980",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
                
                console.log('å›ºå®šç­¾åˆ°äºŒç»´ç ç”ŸæˆæˆåŠŸ');
                
            } catch (error) {
                console.error('ç”ŸæˆäºŒç»´ç å¤±è´¥:', error);
                showMessage('äºŒç»´ç ç”Ÿæˆå¤±è´¥ï¼Œè¯·ä½¿ç”¨å¤‡ç”¨ç½‘å€', 'error');
            }
        }
        
        // ==================== ç­¾åˆ°åŠŸèƒ½ ====================
        function signIn() {
            // è·å–è¡¨å•æ•°æ®
            const nameInput = document.getElementById('name');
            const deptInput = document.getElementById('department');
            const name = nameInput.value.trim();
            const department = deptInput.value.trim();
            
            // éªŒè¯è¾“å…¥
            if (!name) {
                showMessage('è¯·è¾“å…¥æ‚¨çš„å§“å', 'error');
                nameInput.focus();
                return;
            }
            
            if (name.length < 2 || name.length > CONFIG.MAX_NAME_LENGTH) {
                showMessage(`å§“åé•¿åº¦åº”ä¸º2-${CONFIG.MAX_NAME_LENGTH}ä¸ªå­—`, 'error');
                return;
            }
            
            // æ˜¾ç¤ºå¤„ç†ä¸­çŠ¶æ€
            const signinBtn = document.getElementById('signinBtn');
            const originalText = signinBtn.textContent;
            signinBtn.textContent = 'æäº¤ä¸­...';
            signinBtn.disabled = true;
            
            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            setTimeout(() => {
                try {
                    // 1. è·å–æˆ–åˆå§‹åŒ–æ•°æ®å­˜å‚¨
                    let eventData = getEventData();
                    
                    // 2. æ£€æŸ¥æ˜¯å¦å·²ç­¾åˆ°ï¼ˆæ ¹æ®å§“ååˆ¤æ–­ï¼‰
                    const existingUser = eventData.participants.find(p => 
                        p.name === name && (!department || p.department === department)
                    );
                    
                    if (existingUser) {
                        showMessage(`${name} æ‚¨å¥½ï¼æ‚¨å·²äº ${formatTime(existingUser.signTime)} ç­¾åˆ°æˆåŠŸ`, 'warning');
                        
                        // æ›´æ–°æœ€åè®¿é—®æ—¶é—´
                        existingUser.lastAccess = new Date().toISOString();
                        saveEventData(eventData);
                        
                        signinBtn.textContent = originalText;
                        signinBtn.disabled = false;
                        return;
                    }
                    
                    // 3. åˆ›å»ºæ–°çš„ç­¾åˆ°è®°å½•
                    const newParticipant = {
                        id: generateId(),
                        name: name,
                        department: department || 'æœªå¡«å†™',
                        signTime: new Date().toISOString(),
                        lastAccess: new Date().toISOString(),
                        hasLotteryChance: true,  // æ‹¥æœ‰æŠ½å¥–èµ„æ ¼
                        isWinner: false,         // åˆå§‹æœªä¸­å¥–
                        prize: null              // å¥–å“ä¿¡æ¯
                    };
                    
                    // 4. æ·»åŠ åˆ°æ•°æ®åˆ—è¡¨
                    eventData.participants.push(newParticipant);
                    eventData.totalSignins++;
                    eventData.lastUpdate = new Date().toISOString();
                    
                    // 5. ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    saveEventData(eventData);
                    
                    // 6. æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showMessage(
                        `ğŸ‰ ${name}ï¼ˆ${newParticipant.department}ï¼‰ï¼Œç­¾åˆ°æˆåŠŸï¼<br>` +
                        `âœ… æ‚¨å·²è·å¾—æŠ½å¥–èµ„æ ¼<br>` +
                        `â° ç­¾åˆ°æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`,
                        'success'
                    );
                    
                    // 7. æ¸…ç©ºè¡¨å•
                    nameInput.value = '';
                    deptInput.value = '';
                    
                    // 8. æ’­æ”¾æˆåŠŸéŸ³æ•ˆï¼ˆå¯é€‰ï¼‰
                    playSuccessSound();
                    
                    // 9. æ›´æ–°ç»Ÿè®¡æ•°æ®
                    updateStatistics();
                    
                    // 10. è®°å½•æ—¥å¿—
                    console.log('ç­¾åˆ°æˆåŠŸ:', newParticipant);
                    
                } catch (error) {
                    console.error('ç­¾åˆ°è¿‡ç¨‹ä¸­å‡ºé”™:', error);
                    showMessage('ç³»ç»Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                } finally {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    setTimeout(() => {
                        signinBtn.textContent = originalText;
                        signinBtn.disabled = false;
                    }, 1000);
                }
            }, 800);
        }
        
        // ==================== æ•°æ®å­˜å‚¨ç®¡ç† ====================
        function getEventData() {
            const defaultData = {
                eventName: CONFIG.EVENT_NAME,
                participants: [],      // æ‰€æœ‰ç­¾åˆ°äººå‘˜
                totalSignins: 0,       // æ€»ç­¾åˆ°æ¬¡æ•°
                lastUpdate: new Date().toISOString(),
                checkinUrl: window.location.href,  // ä¿å­˜ç­¾åˆ°é¡µé¢URL
                lotteryUrl: ''         // å°†ç”±æŠ½å¥–é¡µé¢è®¾ç½®
            };
            
            try {
                const stored = localStorage.getItem(CONFIG.STORAGE_KEY);
                return stored ? JSON.parse(stored) : defaultData;
            } catch (error) {
                console.error('è¯»å–æœ¬åœ°å­˜å‚¨å¤±è´¥:', error);
                return defaultData;
            }
        }
        
        function saveEventData(data) {
            try {
                localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(data));
                console.log('æ•°æ®ä¿å­˜æˆåŠŸï¼Œå½“å‰äººæ•°:', data.participants.length);
                
                // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–é¡µé¢æ•°æ®å·²æ›´æ–°
                window.dispatchEvent(new CustomEvent('signinDataUpdated', {
                    detail: { count: data.participants.length }
                }));
                
                return true;
            } catch (error) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                showMessage('æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥å­˜å‚¨ç©ºé—´', 'error');
                return false;
            }
        }
        
        // ==================== ä¸ºæŠ½å¥–é¡µé¢ä¿å­˜URL ====================
        function saveCheckinUrlForLottery() {
            // åœ¨localStorageä¸­å­˜å‚¨ä¸€ä¸ªç‰¹æ®Šçš„é”®ï¼Œä¾›æŠ½å¥–é¡µé¢è¯»å–
            try {
                localStorage.setItem('event_checkin_url', window.location.href);
                console.log('ç­¾åˆ°é¡µé¢URLå·²ä¿å­˜ï¼Œä¾›æŠ½å¥–é¡µé¢ä½¿ç”¨');
            } catch (error) {
                console.warn('æ— æ³•ä¿å­˜URL:', error);
            }
        }
        
        // ==================== è¾…åŠ©å‡½æ•° ====================
        function generateId() {
            return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function formatTime(isoString) {
            try {
                return new Date(isoString).toLocaleString('zh-CN');
            } catch {
                return 'æœªçŸ¥æ—¶é—´';
            }
        }
        
        function updateStatistics() {
            const eventData = getEventData();
            const participants = eventData.participants;
            
            // è®¡ç®—ä»Šæ—¥ç­¾åˆ°äººæ•°
            const today = new Date().toDateString();
            const todayCount = participants.filter(p => {
                try {
                    return new Date(p.signTime).toDateString() === today;
                } catch {
                    return false;
                }
            }).length;
            
            // è®¡ç®—æœ‰æŠ½å¥–èµ„æ ¼çš„äººæ•°
            const lotteryCount = participants.filter(p => p.hasLotteryChance).length;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('totalCount').textContent = participants.length;
            document.getElementById('todayCount').textContent = todayCount;
            document.getElementById('lotteryCount').textContent = lotteryCount;
        }
        
        function showMessage(text, type = 'info') {
            const messageEl = document.getElementById('message');
            messageEl.innerHTML = text;
            messageEl.className = type;
            
            // è‡ªåŠ¨éšè—ä¿¡æ¯ï¼ˆé™¤äº†é”™è¯¯ä¿¡æ¯ï¼‰
            if (type !== 'error') {
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 5000);
            }
        }
        
        function checkSigninStatus() {
            const name = document.getElementById('name').value.trim();
            if (!name) {
                showMessage('è¯·è¾“å…¥å§“åä»¥æŸ¥è¯¢çŠ¶æ€', 'warning');
                return;
            }
            
            const eventData = getEventData();
            const user = eventData.participants.find(p => p.name === name);
            
            if (user) {
                showMessage(
                    `ğŸ“‹ <strong>${name}</strong> ç­¾åˆ°çŠ¶æ€ï¼š<br>` +
                    `éƒ¨é—¨ï¼š${user.department}<br>` +
                    `ç­¾åˆ°æ—¶é—´ï¼š${formatTime(user.signTime)}<br>` +
                    `æŠ½å¥–èµ„æ ¼ï¼š${user.hasLotteryChance ? 'âœ… å·²è·å¾—' : 'âŒ æ— èµ„æ ¼'}<br>` +
                    `ä¸­å¥–çŠ¶æ€ï¼š${user.isWinner ? `ğŸŠ å·²ä¸­å¥–ï¼ˆ${user.prize || 'æœªçŸ¥å¥–å“'}ï¼‰` : 'æœªä¸­å¥–'}`,
                    'info'
                );
            } else {
                showMessage(`æœªæ‰¾åˆ° ${name} çš„ç­¾åˆ°è®°å½•ï¼Œè¯·å…ˆå®Œæˆç­¾åˆ°`, 'warning');
            }
        }
        
        function checkQRCodeLibrary() {
            if (typeof QRCode === 'undefined') {
                showMessage('äºŒç»´ç åº“åŠ è½½å¼‚å¸¸ï¼Œè¯·ä½¿ç”¨å¤‡ç”¨ç½‘å€è®¿é—®', 'error');
            }
        }
        
        function playSuccessSound() {
            try {
                // åˆ›å»ºç®€çŸ­çš„æç¤ºéŸ³
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                // é™é»˜å¤±è´¥
            }
        }
        
        // ==================== æ•°æ®å¯¼å‡º/å¯¼å…¥åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰ ====================
        function exportData() {
            const eventData = getEventData();
            const dataStr = JSON.stringify(eventData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            downloadLink.download = `signin_data_${new Date().getTime()}.json`;
            downloadLink.click();
            
            showMessage('æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶', 'info');
        }
        
        // åœ¨æ§åˆ¶å°æš´éœ²ä¸€äº›è°ƒè¯•å‡½æ•°
        console.log('ç­¾åˆ°ç³»ç»Ÿå·²åŠ è½½ï¼Œè°ƒè¯•å‘½ä»¤ï¼š');
        console.log('- signInTest("å§“å") - æµ‹è¯•ç­¾åˆ°');
        console.log- exportData() - å¯¼å‡ºæ•°æ®');
        console.log('- getEventData() - æŸ¥çœ‹æ•°æ®');
    </script>
</body>
</html>
